raindrop:
  graphics:
    - formats:
      - name: "albedo format"
        candidates: [
          VK_FORMAT_R8G8B8_UNORM,
          VK_FORMAT_R8G8B8_UINT,
          VK_FORMAT_R8G8B8A8_UNORM,
          VK_FORMAT_R8G8B8A8_UINT,
        ]

        features:
          optimalTiling: [VK_FORMAT_FEATURE_COLOR_ATTACHMENT_BIT, VK_FORMAT_FEATURE_SAMPLED_IMAGE_BIT]
          linearTiling: ~
          buffer: ~

        image:
          type: VK_IMAGE_TYPE_2D
          tiling: VK_IMAGE_TILING_OPTIMAL
          usage: [VK_IMAGE_USAGE_COLOR_ATTACHMENT_BIT, VK_IMAGE_USAGE_SAMPLED_BIT]
          flags: ~
          samples: ~
          width: 0
          height: 0
          depth: 0
          arrayLayers: 0
          mipLevels: 0
      
      - name: "vec3 format"
        candidates: [
          VK_FORMAT_R32G32B32_SFLOAT,
          VK_FORMAT_R16G16B16_SFLOAT,
          VK_FORMAT_R32G32B32A32_SFLOAT,
          VK_FORMAT_R16G16B16A16_SFLOAT,
        ]

        features:
          optimalTiling: [VK_FORMAT_FEATURE_COLOR_ATTACHMENT_BIT, VK_FORMAT_FEATURE_SAMPLED_IMAGE_BIT]
          linearTiling: ~
          buffer: ~

        image:
          type: VK_IMAGE_TYPE_2D
          tiling: VK_IMAGE_TILING_OPTIMAL
          usage: [VK_IMAGE_USAGE_COLOR_ATTACHMENT_BIT, VK_IMAGE_USAGE_SAMPLED_BIT]
          flags: ~
          samples: ~
          width: 0
          height: 0
          depth: 0
          arrayLayers: 0
          mipLevels: 0
      
      - name: "id format"
        candidates: [
          VK_FORMAT_R8_UINT,
          VK_FORMAT_R16_UINT
        ]

        features:
          optimalTiling: [VK_FORMAT_FEATURE_COLOR_ATTACHMENT_BIT, VK_FORMAT_FEATURE_SAMPLED_IMAGE_BIT]
          linearTiling: ~
          buffer: ~

        image:
          type: VK_IMAGE_TYPE_2D
          tiling: VK_IMAGE_TILING_OPTIMAL
          usage: [VK_IMAGE_USAGE_COLOR_ATTACHMENT_BIT, VK_IMAGE_USAGE_SAMPLED_BIT]
          flags: ~
          samples: ~
          width: 0
          height: 0
          depth: 0
          arrayLayers: 0
          mipLevels: 0
      
      - name: "depth format"
        candidates: [
          VK_FORMAT_D16_UNORM,
          VK_FORMAT_D16_UNORM_S8_UINT,
          VK_FORMAT_D24_UNORM_S8_UINT,
          VK_FORMAT_D32_SFLOAT,
          VK_FORMAT_D32_SFLOAT_S8_UINT,
        ]

        features:
          optimalTiling: [VK_FORMAT_FEATURE_DEPTH_STENCIL_ATTACHMENT_BIT, VK_FORMAT_FEATURE_SAMPLED_IMAGE_BIT]
          linearTiling: ~
          buffer: ~

        image:
          type: VK_IMAGE_TYPE_2D
          tiling: VK_IMAGE_TILING_OPTIMAL
          usage: [VK_IMAGE_USAGE_DEPTH_STENCIL_ATTACHMENT_BIT, VK_IMAGE_USAGE_SAMPLED_BIT]
          flags: ~
          samples: ~
          width: 0
          height: 0
          depth: 0
          arrayLayers: 0
          mipLevels: 0

    - images:
      - name: "albedo image"
        format: "albedo format"
        extent:
          width: ${window.width}
          height: ${window.height}
        type: VK_IMAGE_TYPE_2D
        usage: [VK_IMAGE_USAGE_COLOR_ATTACHMENT_BIT, VK_IMAGE_USAGE_SAMPLED_BIT]
        initialLayout: VK_IMAGE_LAYOUT_UNDEFINED
        mipLevels: 1
        arrayLayers: 1
        sampleCount: VK_SAMPLE_COUNT_1_BIT
        tiling: VK_IMAGE_TILING_OPTIMAL
        queueFamilies: ['${queues.graphicsFamily}']
        features: [VK_FORMAT_FEATURE_COLOR_ATTACHMENT_BIT, VK_FORMAT_FEATURE_SAMPLED_IMAGE_BIT]

      - name: texture id image
        format: "id format"
        extent:
          width: ${window.width}
          height: ${window.height}
        type: VK_IMAGE_TYPE_2D
        usage: [VK_IMAGE_USAGE_COLOR_ATTACHMENT_BIT, VK_IMAGE_USAGE_SAMPLED_BIT]
        initialLayout: VK_IMAGE_LAYOUT_UNDEFINED
        mipLevels: 1
        arrayLayers: 1
        sampleCount: VK_SAMPLE_COUNT_1_BIT
        tiling: VK_IMAGE_TILING_OPTIMAL
        queueFamilies: ['${queues.graphicsFamily}']
        features: [VK_FORMAT_FEATURE_COLOR_ATTACHMENT_BIT, VK_FORMAT_FEATURE_SAMPLED_IMAGE_BIT]
      
      - name: normals image
        format: "vec3 format"
        extent:
          width: ${window.width}
          height: ${window.height}
        type: VK_IMAGE_TYPE_2D
        usage: [VK_IMAGE_USAGE_COLOR_ATTACHMENT_BIT, VK_IMAGE_USAGE_SAMPLED_BIT]
        initialLayout: VK_IMAGE_LAYOUT_UNDEFINED
        mipLevels: 1
        arrayLayers: 1
        sampleCount: VK_SAMPLE_COUNT_1_BIT
        tiling: VK_IMAGE_TILING_OPTIMAL
        queueFamilies: ['${queues.graphicsFamily}']
        features: [VK_FORMAT_FEATURE_COLOR_ATTACHMENT_BIT, VK_FORMAT_FEATURE_SAMPLED_IMAGE_BIT]

      - name: positions image
        format: "vec3 format"
        extent:
          width: ${window.width}
          height: ${window.height}
        type: VK_IMAGE_TYPE_2D
        usage: [VK_IMAGE_USAGE_COLOR_ATTACHMENT_BIT, VK_IMAGE_USAGE_SAMPLED_BIT]
        initialLayout: VK_IMAGE_LAYOUT_UNDEFINED
        mipLevels: 1
        arrayLayers: 1
        sampleCount: VK_SAMPLE_COUNT_1_BIT
        tiling: VK_IMAGE_TILING_OPTIMAL
        queueFamilies: ['${queues.graphicsFamily}']
        features: [VK_FORMAT_FEATURE_COLOR_ATTACHMENT_BIT, VK_FORMAT_FEATURE_SAMPLED_IMAGE_BIT]
      
      - name: depth image
        format: "depth format"
        extent:
          width: ${window.width}
          height: ${window.height}
        type: VK_IMAGE_TYPE_2D
        usage: [VK_IMAGE_USAGE_DEPTH_STENCIL_ATTACHMENT_BIT, VK_IMAGE_USAGE_SAMPLED_BIT]
        initialLayout: VK_IMAGE_LAYOUT_UNDEFINED
        mipLevels: 1
        arrayLayers: 1
        sampleCount: VK_SAMPLE_COUNT_1_BIT
        tiling: VK_IMAGE_TILING_OPTIMAL
        queueFamilies: ["${queues.graphicsFamily}"]
        features: [VK_FORMAT_FEATURE_DEPTH_STENCIL_ATTACHMENT_BIT, VK_FORMAT_FEATURE_SAMPLED_IMAGE_BIT]

    - imageViews:
      - name: depth image view
        base: depth image
        viewType: VK_IMAGE_VIEW_TYPE_2D
        format: ~
        componentMapping:
          r: VK_COMPONENT_SWIZZLE_IDENTITY
          g: VK_COMPONENT_SWIZZLE_IDENTITY
          b: VK_COMPONENT_SWIZZLE_IDENTITY
          a: VK_COMPONENT_SWIZZLE_IDENTITY
        subresourceRange:
          aspectMask: [VK_IMAGE_ASPECT_DEPTH_BIT]
          baseMipLevel: 0
          levelCount: 1
          baseArray: 0
          layerCount: 1
          
      - name: albedo image view
        base: albedo image
        viewType: VK_IMAGE_VIEW_TYPE_2D
        format: ~
        componentMapping:
          r: VK_COMPONENT_SWIZZLE_IDENTITY
          g: VK_COMPONENT_SWIZZLE_IDENTITY
          b: VK_COMPONENT_SWIZZLE_IDENTITY
          a: VK_COMPONENT_SWIZZLE_IDENTITY
        subresourceRange:
          aspectMask: [VK_IMAGE_ASPECT_COLOR_BIT]
          baseMipLevel: 0
          levelCount: 1
          baseArray: 0
          layerCount: 1

      - name: texture id image view
        base: texture id image
        viewType: VK_IMAGE_VIEW_TYPE_2D
        format: ~
        componentMapping:
          r: VK_COMPONENT_SWIZZLE_IDENTITY
          g: VK_COMPONENT_SWIZZLE_IDENTITY
          b: VK_COMPONENT_SWIZZLE_IDENTITY
          a: VK_COMPONENT_SWIZZLE_IDENTITY
        subresourceRange:
          aspectMask: [VK_IMAGE_ASPECT_COLOR_BIT]
          baseMipLevel: 0
          levelCount: 1
          baseArray: 0
          layerCount: 1
      
      - name: normals image view
        base: normals image
        viewType: VK_IMAGE_VIEW_TYPE_2D
        format: ~
        componentMapping:
          r: VK_COMPONENT_SWIZZLE_IDENTITY
          g: VK_COMPONENT_SWIZZLE_IDENTITY
          b: VK_COMPONENT_SWIZZLE_IDENTITY
          a: VK_COMPONENT_SWIZZLE_IDENTITY
        subresourceRange:
          aspectMask: [VK_IMAGE_ASPECT_COLOR_BIT]
          baseMipLevel: 0
          levelCount: 1
          baseArray: 0
          layerCount: 1

      - name: positions image view
        base: positions image
        viewType: VK_IMAGE_VIEW_TYPE_2D
        format: ~
        componentMapping:
          r: VK_COMPONENT_SWIZZLE_IDENTITY
          g: VK_COMPONENT_SWIZZLE_IDENTITY
          b: VK_COMPONENT_SWIZZLE_IDENTITY
          a: VK_COMPONENT_SWIZZLE_IDENTITY
        subresourceRange:
          aspectMask: [VK_IMAGE_ASPECT_COLOR_BIT]
          baseMipLevel: 0
          levelCount: 1
          baseArray: 0
          layerCount: 1
      
    - renderPasses:
      - name: render pass
        flags: ~

        attachments:
          - name: depth attachment
            flags: ~
            format: "depth format"
            sampleCount: VK_SAMPLE_COUNT_1_BIT
            loadOp: VK_ATTACHMENT_LOAD_OP_DONT_CARE
            storeOp: VK_ATTACHMENT_STORE_OP_STORE
            stencilLoadOp: VK_ATTACHMENT_LOAD_OP_DONT_CARE
            stencilStoreOp: VK_ATTACHMENT_STORE_OP_DONT_CARE
            initialLayout: VK_IMAGE_LAYOUT_DEPTH_STENCIL_ATTACHMENT_OPTIMAL
            finalLayout: VK_IMAGE_LAYOUT_SHADER_READ_ONLY_OPTIMAL

          - name: albedo attachment
            flags: ~
            format: "albedo format"
            sampleCount: VK_SAMPLE_COUNT_1_BIT
            loadOp: VK_ATTACHMENT_LOAD_OP_DONT_CARE
            storeOp: VK_ATTACHMENT_STORE_OP_STORE
            stencilLoadOp: VK_ATTACHMENT_LOAD_OP_DONT_CARE
            stencilStoreOp: VK_ATTACHMENT_STORE_OP_DONT_CARE
            initialLayout: VK_IMAGE_LAYOUT_COLOR_ATTACHMENT_OPTIMAL
            finalLayout: VK_IMAGE_LAYOUT_SHADER_READ_ONLY_OPTIMAL

          - name: texture id attachment
            flags: ~
            format: "id format"
            sampleCount: VK_SAMPLE_COUNT_1_BIT
            loadOp: VK_ATTACHMENT_LOAD_OP_DONT_CARE
            storeOp: VK_ATTACHMENT_STORE_OP_STORE
            stencilLoadOp: VK_ATTACHMENT_LOAD_OP_DONT_CARE
            stencilStoreOp: VK_ATTACHMENT_STORE_OP_DONT_CARE
            initialLayout: VK_IMAGE_LAYOUT_COLOR_ATTACHMENT_OPTIMAL
            finalLayout: VK_IMAGE_LAYOUT_SHADER_READ_ONLY_OPTIMAL

          - name: normals attachment
            flags: ~
            format: "vec3 format"
            sampleCount: VK_SAMPLE_COUNT_1_BIT
            loadOp: VK_ATTACHMENT_LOAD_OP_DONT_CARE
            storeOp: VK_ATTACHMENT_STORE_OP_STORE
            stencilLoadOp: VK_ATTACHMENT_LOAD_OP_DONT_CARE
            stencilStoreOp: VK_ATTACHMENT_STORE_OP_DONT_CARE
            initialLayout: VK_IMAGE_LAYOUT_COLOR_ATTACHMENT_OPTIMAL
            finalLayout: VK_IMAGE_LAYOUT_SHADER_READ_ONLY_OPTIMAL

          - name: positions attachment
            flags: ~
            format: "vec3 format"
            sampleCount: VK_SAMPLE_COUNT_1_BIT
            loadOp: VK_ATTACHMENT_LOAD_OP_DONT_CARE
            storeOp: VK_ATTACHMENT_STORE_OP_STORE
            stencilLoadOp: VK_ATTACHMENT_LOAD_OP_DONT_CARE
            stencilStoreOp: VK_ATTACHMENT_STORE_OP_DONT_CARE
            initialLayout: VK_IMAGE_LAYOUT_COLOR_ATTACHMENT_OPTIMAL
            finalLayout: VK_IMAGE_LAYOUT_SHADER_READ_ONLY_OPTIMAL
        
        subpasses:
          - name: subpass
            flags: ~
            pipelineBindPoint: VK_PIPELINE_BIND_POINT_GRAPHICS
            preserveAttachments: ~
            inputAttachments: ~
            resolveAttachments: ~
            colorAttachments:
              - base: albedo attachment
                layout: VK_IMAGE_LAYOUT_COLOR_ATTACHMENT_OPTIMAL
              - base: texture id attachment
                layout: VK_IMAGE_LAYOUT_COLOR_ATTACHMENT_OPTIMAL
              - base: normals attachment
                layout: VK_IMAGE_LAYOUT_COLOR_ATTACHMENT_OPTIMAL
              - base: positions attachment
                layout: VK_IMAGE_LAYOUT_COLOR_ATTACHMENT_OPTIMAL
            
            depthAttachment:
              base: depth attachment
              layout: VK_IMAGE_LAYOUT_DEPTH_STENCIL_ATTACHMENT_OPTIMAL
          
        dependencies:
          - flags: ~
            srcSubpass: ~
            dstSubpass: subpass
            srcStageMask: [VK_PIPELINE_STAGE_COLOR_ATTACHMENT_OUTPUT_BIT, VK_PIPELINE_STAGE_EARLY_FRAGMENT_TESTS_BIT]
            dstStageMask: [VK_PIPELINE_STAGE_COLOR_ATTACHMENT_OUTPUT_BIT, VK_PIPELINE_STAGE_EARLY_FRAGMENT_TESTS_BIT]
            srcAccessMask: ~
            dstAccessMask: [VK_ACCESS_COLOR_ATTACHMENT_WRITE_BIT, VK_ACCESS_DEPTH_STENCIL_ATTACHMENT_WRITE_BIT]

    - vertexLayouts:
      - name: "empty layout"
        bindings: ~
      
      - name: "simple layout"
        bindings: 
          - inputRate: VK_VERTEX_INPUT_RATE_VERTEX
            attributes:
              - name: "position"
                format: VK_FORMAT_R32G32B32_SFLOAT
                type: Position
              - name: "UV"
                format: VK_FORMAT_R32G32_SFLOAT
                type: Uv
              - name: "normal"
                format: VK_FORMAT_R32G32B32_SFLOAT
                type: Normal

    - framebuffers:
      - name: gbuffer
        flags: ~
        renderPass: render pass
        attachments: [
          depth image view,
          albedo image view,
          texture id image view,
          normals image view,
          positions image view
        ]
        width: ${window.width}
        height: ${window.height}
        layers: 1

    - pipelineLayouts:
      - name: "default pipeline layout"
        pushConstants:
          - pushConstant:
            size: 128
            offset: 0
            stages: [VK_SHADER_STAGE_VERTEX_BIT, VK_SHADER_STAGE_FRAGMENT_BIT]
      - name: "empty pipeline layout"
    
    - graphicsPipelines:
      - name: "default graphics pipeline"
        flags: ~

        stages:
          - name: "main"
            stage: VK_SHADER_STAGE_VERTEX_BIT
            flags: ~
            shader: ${resourcesDir}/shaders/shader.vert.glsl.spv
          - name: "main"
            stage: VK_SHADER_STAGE_FRAGMENT_BIT
            flags: ~
            shader: ${resourcesDir}/shaders/shader.frag.glsl.spv
        
        inputStateCreateInfo:
          layout: "empty layout"
          # vertexAttributeDescriptions: []
          #   # - binding: 0
          #   #   inputRate: VK_VERTEX_INPUT_RATE_VERTEX
          #   #   stride: 12
          # vertexBindingDescriptions: []
          #   # - binding: 0
          #   #   format: VK_FORMAT_R32G32B32_SFLOAT
          #   #   location: 0
          #   #   offset: 0
          #   # - binding: 0
          #   #   format: VK_FORMAT_R32G32B32_SFLOAT
          #   #   location: 1
            #   offset: 12
        
        inputAssemblyStateCreateInfo:
          primitiveRestartEnable: false
          topology: VK_PRIMITIVE_TOPOLOGY_TRIANGLE_LIST
        
        viewportStateCreateInfo:
          viewports: 
            - x: 0
              y: 0
              width: 1080
              height: 720
              minDepth: 0
              maxDepth: 1
          
          scissors:
            - offsetY: 0
              offsetX: 0
              extentWidth: 1080
              extentHeight: 720
            
        rasterizationStateCreateInfo:
          depthClampEnable: false
          rasterizerDiscardEnable: false
          polygonMode: VK_POLYGON_MODE_FILL
          cullMode: [VK_CULL_MODE_NONE]
          frontFace: VK_FRONT_FACE_CLOCKWISE
          depthBiasEnable: true
          depthBiasConstantFactor: 0
          depthBiasClamp: 0
          depthBiasSlopFactor: 0
          lineWidth: 1
        
        multisampleStateCreateInfo:
          rasterizationSamples: VK_SAMPLE_COUNT_1_BIT
          sampleShadingEnable: false
          minSampleShading: 1
          sampleMask: ~
          alphaToCoverageEnable: false
          alphaToOneEnable: false
          
        colorBlendStateCreateInfo:
          flags: ~
          logicOpEnable: false
          logicOp: VK_LOGIC_OP_COPY
          blendConstants:
            R: 0
            G: 0
            B: 0
            A: 0
          
          attachments:
            - blendEnable: true
              colorBlendOp: VK_BLEND_OP_ADD
              srcColorBlendFactor: VK_BLEND_FACTOR_SRC_ALPHA
              dstColorBlendFactor: VK_BLEND_FACTOR_ONE_MINUS_SRC_ALPHA
              alphaBlendOp: VK_BLEND_OP_ADD
              srcAlphaBlendFactor : VK_BLEND_FACTOR_ONE
              dstAlphaBlendFactor: VK_BLEND_FACTOR_ZERO
              colorWriteMask: [VK_COLOR_COMPONENT_R_BIT, VK_COLOR_COMPONENT_G_BIT, VK_COLOR_COMPONENT_B_BIT, VK_COLOR_COMPONENT_A_BIT]

        depthStencilStateCreateInfo:
          flags: ~
          depthTestEnable: true
          depthWriteEnable: true
          depthCompareOp: VK_COMPARE_OP_LESS
          minDepthBounds: 0
          maxDepthBounds: 1
          stencilTestEnable: false
          depthBoundsTestEnable: false
          front:
            compareMask: "0"
            writeMask: "0"
            compareOp: VK_COMPARE_OP_NEVER
            depthFailOp: VK_STENCIL_OP_KEEP
            failOp: VK_STENCIL_OP_KEEP
            passOp: VK_STENCIL_OP_KEEP
            reference: 0
          back:
            compareMask: "0"
            writeMask: "0"
            compareOp: VK_COMPARE_OP_NEVER
            depthFailOp: VK_STENCIL_OP_KEEP
            failOp: VK_STENCIL_OP_KEEP
            passOp: VK_STENCIL_OP_KEEP
            reference: 0
          
        dynamicStateCreateInfo:
          dynamicStates:
            - VK_DYNAMIC_STATE_VIEWPORT
            - VK_DYNAMIC_STATE_SCISSOR
          
        tesselationStateCreateInfo:
          patchControlPoints: 0
        
        renderPass: "swapchain render pass"
        layout: "default pipeline layout"